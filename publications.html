<!DOCTYPE html>
<html lang="en" id="html-root">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Publications by Mohammad Ashfaq Ur Rahman, Research Intern at CCDS, IUB. Academic research and conference papers."
    />
    <title>Publications | Academic Profile</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles/animations.css" />
    <script src="https://cdn.tailwindcss.com?plugins=typography,forms"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            fontFamily: {
              sans: ["Inter", "system-ui", "sans-serif"],
            },
            // Extending typography to customize prose styles
            typography: ({ theme }) => ({
              custom: {
                css: {
                  "--tw-prose-body": theme("colors.slate[600]"),
                  "--tw-prose-headings": theme("colors.slate[800]"),
                  "--tw-prose-links": theme("colors.teal[600]"),
                  "--tw-prose-bold": theme("colors.slate[800]"),
                  "--tw-prose-bullets": theme("colors.slate[400]"),
                  "--tw-prose-hr": theme("colors.slate[200]"),
                  "--tw-prose-quotes": theme("colors.slate[800]"),
                  "--tw-prose-quote-borders": theme("colors.teal[300]"),

                  "--tw-prose-invert-body": theme("colors.slate[300]"),
                  "--tw-prose-invert-headings": theme("colors.slate[100]"),
                  "--tw-prose-invert-links": theme("colors.teal[400]"),
                  "--tw-prose-invert-bold": theme("colors.slate[100]"),
                  "--tw-prose-invert-bullets": theme("colors.slate[600]"),
                  "--tw-prose-invert-hr": theme("colors.slate[700]"),
                  "--tw-prose-invert-quotes": theme("colors.slate[100]"),
                  "--tw-prose-invert-quote-borders": theme("colors.teal[700]"),
                },
              },
            }),
            keyframes: {
              fadeIn: {
                "0%": { opacity: "0", transform: "translateY(10px)" },
                "100%": { opacity: "1", transform: "translateY(0)" },
              },
              fadeOut: {
                "0%": { opacity: "1", transform: "translateY(0)" },
                "100%": { opacity: "0", transform: "translateY(10px)" },
              },
              float: {
                "0%, 100%": { transform: "translateY(0)" },
                "50%": { transform: "translateY(-5px)" },
              },
              glow: {
                "0%, 100%": { boxShadow: "0 0 0 rgba(45, 212, 191, 0)" },
                "50%": { boxShadow: "0 0 15px rgba(45, 212, 191, 0.3)" },
              },
              scale: {
                "0%": { transform: "scale(0.95)" },
                "100%": { transform: "scale(1)" },
              },
              slideIn: {
                "0%": { transform: "translateX(-20px)", opacity: "0" },
                "100%": { transform: "translateX(0)", opacity: "1" },
              },
            },
            animation: {
              fadeIn: "fadeIn 0.2s ease-out forwards",
              fadeOut: "fadeOut 0.2s ease-out forwards",
              float: "float 3s ease-in-out infinite",
              glow: "glow 3s ease-in-out infinite",
              scale: "scale 0.2s ease-out forwards",
              slideIn: "slideIn 0.3s ease-out forwards",
            },
          },
        },
      };
    </script>
  </head>

  <body
    class="font-sans bg-slate-50 text-slate-700 dark:bg-slate-900 dark:text-slate-300 min-h-screen flex flex-col transition-colors duration-300"
  >
    <div id="header-partial"></div>

    <main class="flex-1 w-full max-w-4xl mx-auto px-3 sm:px-4 pb-6 sm:pb-10 pt-24 sm:pt-28">
      <section
        id="publications"
        class="rounded-xl sm:rounded-2xl bg-white/50 dark:bg-slate-800/50 backdrop-blur-xl shadow-lg border border-slate-200/50 dark:border-slate-700/50 p-3 sm:p-6 md:p-8 transition-all duration-500 hover:shadow-2xl hover:-translate-y-1 hover:border-teal-500/20 dark:hover:border-teal-400/20"
      >
        <div class="flex items-center gap-3 sm:gap-4 mb-4 sm:mb-6 group">
          <div class="relative">
            <i
              data-lucide="book-open-check"
              class="w-7 h-7 sm:w-8 sm:h-8 text-teal-500 dark:text-teal-400 transition-transform duration-300 group-hover:scale-110 group-hover:rotate-3"
            ></i>
            <div
              class="absolute inset-0 bg-teal-500/20 dark:bg-teal-400/20 rounded-full blur-xl group-hover:blur-2xl transition-all duration-300 opacity-0 group-hover:opacity-100"
            ></div>
          </div>
          <h1
            class="text-xl sm:text-2xl md:text-3xl font-bold bg-gradient-to-r from-teal-600 to-teal-500 dark:from-teal-400 dark:to-teal-300 bg-clip-text text-transparent group-hover:scale-[1.02] transition-transform duration-300"
          >
            Publications
          </h1>
        </div>

        <!-- Search Bar -->
        <div class="relative mb-6 sm:mb-8 group">
          <div
            class="absolute -inset-1 bg-gradient-to-r from-teal-500/20 to-slate-500/20 dark:from-teal-400/20 dark:to-slate-400/20 rounded-lg sm:rounded-xl blur opacity-0 group-hover:opacity-100 transition duration-500"
          ></div>
          <div class="relative">
            <i
              data-lucide="search"
              class="w-4 h-4 sm:w-5 sm:h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 group-focus-within:text-teal-500 dark:group-focus-within:text-teal-400 transition-all duration-300 group-focus-within:scale-110"
            ></i>
            <input
              type="text"
              id="publication-search"
              placeholder="Search publications..."
              class="w-full pl-8 sm:pl-10 pr-3 sm:pr-4 py-2.5 sm:py-3 text-sm sm:text-base rounded-lg sm:rounded-xl border border-slate-200/50 dark:border-slate-700/50 bg-white/70 dark:bg-slate-800/70 backdrop-blur-sm text-slate-800 dark:text-slate-200 placeholder-slate-400 dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-teal-500/30 dark:focus:ring-teal-400/30 focus:border-teal-500/50 dark:focus:border-teal-400/50 hover:border-slate-300 dark:hover:border-slate-600 hover:bg-white/80 dark:hover:bg-slate-800/80 transition-all duration-300 ease-out scale-100 focus:scale-[1.01] shadow-sm hover:shadow-md"
            />
            <div
              class="absolute right-3 top-1/2 transform -translate-y-1/2 text-xs text-slate-400 dark:text-slate-500 hidden sm:block opacity-0 group-focus-within:opacity-100 transition-all duration-300 delay-200 group-focus-within:translate-x-0 translate-x-2"
            >
              <span
                class="bg-slate-100 dark:bg-slate-700/50 px-2 py-1 rounded-md backdrop-blur-sm"
              >
                Search by title, authors, or content
              </span>
            </div>
          </div>
        </div>

        <div
          id="publications-md"
          class="prose prose-custom dark:prose-invert max-w-none prose-a:transition-colors prose-a:duration-200 hover:prose-a:text-teal-700 dark:hover:prose-a:text-teal-300"
        ></div>
      </section>
    </main>

    <div id="footer-partial"></div>

    <script src="scripts/partials.js"></script>
    <script>
      // Configure marked.js for consistency
      marked.setOptions({
        mangle: false,
        headerIds: false,
      });

      // Load and render publications.md in custom sectioned format
      fetch("content/publications.md")
        .then((res) => {
          if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
          return res.text();
        })
        .then((md) => {
          // Remove legacy reference definitions if present
          md = md.replace(
            /^\s*\[([^\]]+)\]:\s*(\S+)(?:\s+"([^"]+)")?\s*$/gm,
            ""
          );

          // Split into publication entries by ---
          const entries = md
            .split(/\r?\n-{3,}\r?\n/)
            .map((e) => e.trim())
            .filter(Boolean);

          // Parse entries and sort by year in descending order
          const parsedEntries = entries
            .map((entry) => {
              const parsed = parseEntry(entry);
              // Extract year as number for sorting
              const year = parseInt(parsed.year) || 0;
              return { ...parsed, numericYear: year };
            })
            .sort((a, b) => b.numericYear - a.numericYear);

          // Parse each entry into fields
          function parseEntry(entry) {
            const fields = {};
            let current = null;
            entry.split(/\r?\n/).forEach((line) => {
              const sec = line.match(/^\[(\w+)\]$/);
              if (sec) {
                current = sec[1].toLowerCase();
                fields[current] = "";
              } else if (current) {
                if (fields[current]) fields[current] += "\n";
                fields[current] += line.trim();
              }
            });
            return fields;
          }

          // Render each publication
          const rendered = parsedEntries
            .map((f) => {
              // Label (e.g., "Vision")
              let labelHtml = f.label
                ? `<div class="mb-1.5 sm:mb-2"><span class="inline-block px-2 sm:px-3 py-0.5 sm:py-1 rounded-sm bg-teal-600 dark:bg-teal-700 text-white text-[10px] sm:text-xs font-medium shadow-sm">${escapeHtml(
                    f.label
                  )}</span></div>`
                : "";

              // Image with background and border
              let imgHtml = f.image
                ? `<div class="bg-white dark:bg-slate-800 rounded-lg w-20 h-20 sm:w-32 sm:h-32 flex items-center justify-center border border-slate-200 dark:border-slate-700 shadow-sm"><img src="${escapeHtml(
                    f.image
                  )}" alt="${escapeHtml(
                    f.title || "Publication image"
                  )}" class="w-full h-full object-contain p-1 rounded-lg"></div>`
                : "";

              // Title - same line as year
              let titleHtml = f.title
                ? `<div class="font-bold text-base text-slate-800 dark:text-white">${escapeHtml(
                    f.title
                  )}</div>`
                : "";

              // Year on same line as title
              let yearHtml = f.year
                ? `<div class="text-slate-600 dark:text-slate-400 ml-auto pl-4">${escapeHtml(
                    f.year
                  )}</div>`
                : "";

              // Venue (conference/journal)
              let venueHtml = f.venue
                ? `<div class="text-xs sm:text-sm text-slate-500 dark:text-slate-400 mb-1">${escapeHtml(
                    f.venue
                  )}</div>`
                : "";

              // Authors - with link styling
              let authorHtml = f.author
                ? `<div class="text-sm mt-1 mb-2"><span class="text-slate-600 dark:text-slate-300">${f.author
                    .split(",")
                    .map((author) =>
                      author.includes("Mohammad Ashfaq")
                        ? `<a href="#" class="text-teal-600 dark:text-teal-400 hover:underline">${author.trim()}</a>`
                        : author
                    )
                    .join(", ")}</span></div>`
                : "";

              // Extract URLs from markdown-style links [text](url)
              function extractUrl(text) {
                const match = text.match(/\[([^\]]+)\]\(([^)]+)\)/);
                return match ? match[2] : text;
              }

              // Buttons with icons
              const buttonBaseClass = `
                inline-flex items-center gap-1 sm:gap-1.5 px-2 sm:px-3 py-1 sm:py-1.5 rounded-md sm:rounded-lg border border-slate-200/50 dark:border-slate-700/50 
                text-slate-600 dark:text-slate-300 text-[11px] sm:text-xs font-medium 
                bg-white/50 dark:bg-slate-800/50 backdrop-blur-sm
                hover:border-teal-500/50 dark:hover:border-teal-400/50
                hover:text-teal-600 dark:hover:text-teal-400
                hover:scale-105 active:scale-95
                hover:shadow-md hover:shadow-teal-500/5 dark:hover:shadow-teal-400/5
                hover:bg-white/80 dark:hover:bg-slate-800/80
                transition-all duration-300 ease-out
                touch-manipulation
              `;

              let codeHtml = f.code
                ? `<a href="${escapeHtml(
                    extractUrl(f.code)
                  )}" target="_blank" rel="noopener" 
                    class="${buttonBaseClass}">
                    <i data-lucide="code-2" class="w-3.5 h-3.5"></i>Code</a>`
                : "";

              let paperHtml = f.paper
                ? `<a href="${escapeHtml(
                    extractUrl(f.paper)
                  )}" target="_blank" rel="noopener" 
                    class="${buttonBaseClass}">
                    <i data-lucide="file-text" class="w-3.5 h-3.5"></i>Paper</a>`
                : "";

              let bibHtml = f.bib
                ? `<button onclick="copyBibTeX(this, \`${escapeHtml(
                    f.bib
                  )}\`)" class="${buttonBaseClass}">
                <i data-lucide="quote" class="w-3.5 h-3.5"></i>BIB</button>`
                : ``;

              return `
              <div class="publication-item border-b border-slate-200/50 dark:border-slate-700/50 py-6 opacity-0 animate-slideIn group">
                <div class="relative rounded-xl p-4 -mx-4">
                  <div class="absolute inset-0 bg-gradient-to-r from-teal-500/5 to-slate-500/5 dark:from-teal-400/5 dark:to-slate-400/5 opacity-0 group-hover:opacity-100 transition-all duration-500 rounded-xl"></div>
                  <div class="flex flex-col sm:flex-row gap-4 sm:gap-6 relative">
                    <div class="flex flex-row sm:flex-col items-center sm:items-start">
                      ${labelHtml}
                      <div class="flex-shrink-0 transition-all duration-500 hover:scale-105 group-hover:animate-float relative">
                        <div class="absolute -inset-2 bg-teal-500/20 dark:bg-teal-400/20 rounded-2xl blur-xl opacity-0 group-hover:opacity-70 transition-opacity duration-500"></div>
                        ${imgHtml}
                      </div>
                    </div>
                    <div class="flex-1 min-w-0 mt-4 sm:mt-0">
                      <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-0">
                        ${titleHtml.replace(
                          'class="',
                          'class="group-hover:text-teal-600 dark:group-hover:text-teal-400 transition-colors duration-300 '
                        )}
                        ${yearHtml}
                      </div>
                      ${venueHtml}
                      ${authorHtml}
                      <div class="flex flex-row flex-wrap gap-2 mt-4 opacity-90 group-hover:opacity-100 transition-all duration-300 transform group-hover:translate-y-0 translate-y-1">
                        ${codeHtml}${paperHtml}${bibHtml}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            `;
            })
            .join("\n");

          document.getElementById("publications-md").innerHTML =
            rendered || `<p class="text-slate-500">No publications found.</p>`;

          // Re-initialize Lucide icons for the newly added buttons
          lucide.createIcons();
        })
        .catch((err) => {
          console.error(`Failed to load content/publications.md:`, err);
          document.getElementById(
            "publications-md"
          ).innerHTML = `<p class="text-slate-500">Could not load publications.</p>`;
        });

      // small helper to escape HTML in alt text
      function escapeHtml(str) {
        return String(str).replace(/[&<>"']/g, function (s) {
          return {
            "&": "&amp;",
            "<": "&lt;",
            ">": "&gt;",
            '"': "&quot;",
            "'": "&#39;",
          }[s];
        });
      }

      // Re-render Lucide icons after content is loaded
      setTimeout(() => {
        lucide.createIcons();
      }, 0);

      // Function to copy BibTeX citation to clipboard
      function copyBibTeX(button, bibText) {
        navigator.clipboard
          .writeText(bibText)
          .then(() => {
            // Store original content
            const originalContent = button.innerHTML;
            // Show copied state
            button.innerHTML = `<i data-lucide="check" class="w-3.5 h-3.5"></i>Copied!`;
            // Reinitialize icon
            lucide.createIcons();
            // Reset after 2 seconds
            setTimeout(() => {
              button.innerHTML = originalContent;
              lucide.createIcons();
            }, 2000);
          })
          .catch((err) => {
            console.error("Failed to copy text: ", err);
          });
      }

      // Handle publication search
      let allPublications = []; // Store all publication elements
      const searchInput = document.getElementById("publication-search");

      // Function to initialize search functionality after content is loaded
      function initializeSearch() {
        // Store all publication items
        allPublications = Array.from(
          document.getElementsByClassName("publication-item")
        );

        // Add search event listener
        searchInput.addEventListener("input", function (e) {
          const searchTerm = e.target.value.toLowerCase();

          allPublications.forEach((pub) => {
            const content = pub.textContent.toLowerCase();
            const isVisible = content.includes(searchTerm);
            pub.style.display = isVisible ? "block" : "none";

            // Add/remove animation classes
            if (isVisible) {
              pub.classList.add("animate-fadeIn");
              pub.classList.remove("animate-fadeOut");
            } else {
              pub.classList.add("animate-fadeOut");
              pub.classList.remove("animate-fadeIn");
            }
          });

          // Show "no results" message if no publications are visible
          const hasVisiblePublications = allPublications.some(
            (pub) => pub.style.display !== "none"
          );
          const noResultsMsg = document.getElementById("no-results-message");

          if (!hasVisiblePublications) {
            if (!noResultsMsg) {
              const msg = document.createElement("div");
              msg.id = "no-results-message";
              msg.className = "text-slate-500 text-center py-8 animate-fadeIn";
              msg.innerHTML = "No publications found matching your search.";
              document.getElementById("publications-md").appendChild(msg);
            }
          } else if (noResultsMsg) {
            noResultsMsg.remove();
          }
        });
      }

      // Call initializeSearch after content is loaded
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.addedNodes.length) {
            if (
              document.getElementsByClassName("publication-item").length > 0
            ) {
              initializeSearch();
              observer.disconnect();
            }
          }
        });
      });

      observer.observe(document.getElementById("publications-md"), {
        childList: true,
        subtree: true,
      });
    </script>
  </body>
</html>

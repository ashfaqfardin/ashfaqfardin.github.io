<!DOCTYPE html>
<html lang="en" id="html-root">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Publications by Mohammad Ashfaq Ur Rahman, Research Intern at CCDS, IUB. Academic research and conference papers."
    />
    <title>Publications | Academic Profile</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles/animations.css" />
    <script src="https://cdn.tailwindcss.com?plugins=typography,forms"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            fontFamily: {
              sans: ["Inter", "system-ui", "sans-serif"],
            },
            // Extending typography to customize prose styles
            typography: ({ theme }) => ({
              custom: {
                css: {
                  "--tw-prose-body": theme("colors.slate[600]"),
                  "--tw-prose-headings": theme("colors.slate[800]"),
                  "--tw-prose-links": theme("colors.teal[600]"),
                  "--tw-prose-bold": theme("colors.slate[800]"),
                  "--tw-prose-bullets": theme("colors.slate[400]"),
                  "--tw-prose-hr": theme("colors.slate[200]"),
                  "--tw-prose-quotes": theme("colors.slate[800]"),
                  "--tw-prose-quote-borders": theme("colors.teal[300]"),

                  "--tw-prose-invert-body": theme("colors.slate[300]"),
                  "--tw-prose-invert-headings": theme("colors.slate[100]"),
                  "--tw-prose-invert-links": theme("colors.teal[400]"),
                  "--tw-prose-invert-bold": theme("colors.slate[100]"),
                  "--tw-prose-invert-bullets": theme("colors.slate[600]"),
                  "--tw-prose-invert-hr": theme("colors.slate[700]"),
                  "--tw-prose-invert-quotes": theme("colors.slate[100]"),
                  "--tw-prose-invert-quote-borders": theme("colors.teal[700]"),
                },
              },
            }),
          },
        },
      };
    </script>
  </head>

  <body
    class="font-sans bg-slate-50 text-slate-700 dark:bg-slate-900 dark:text-slate-300 min-h-screen flex flex-col transition-colors duration-300"
  >
    <div id="header-partial"></div>

    <main class="flex-1 w-full max-w-4xl mx-auto px-4 pb-10 pt-28">
      <section
        id="publications"
        class="rounded-2xl bg-white/50 dark:bg-slate-800/50 backdrop-blur-lg shadow-lg border border-slate-200 dark:border-slate-700 p-6 sm:p-8 transition-all duration-300 hover:shadow-xl hover:-translate-y-1"
      >
        <div class="flex items-center gap-4 mb-6">
          <i
            data-lucide="book-open-check"
            class="w-8 h-8 text-teal-500 dark:text-teal-400"
          ></i>
          <h1
            class="text-2xl sm:text-3xl font-bold text-teal-600 dark:text-teal-400"
          >
            Publications
          </h1>
        </div>

        <div
          id="publications-md"
          class="prose prose-custom dark:prose-invert max-w-none prose-a:transition-colors prose-a:duration-200 hover:prose-a:text-teal-700 dark:hover:prose-a:text-teal-300"
        ></div>
      </section>
    </main>

    <div id="footer-partial"></div>

    <script src="scripts/partials.js"></script>
    <script>
      // Configure marked.js for consistency
      marked.setOptions({
        mangle: false,
        headerIds: false,
      });

      // Load and render publications.md in custom sectioned format
      fetch("content/publications.md")
        .then((res) => {
          if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
          return res.text();
        })
        .then((md) => {
          // Remove legacy reference definitions if present
          md = md.replace(
            /^\s*\[([^\]]+)\]:\s*(\S+)(?:\s+"([^"]+)")?\s*$/gm,
            ""
          );

          // Split into publication entries by ---
          const entries = md
            .split(/\r?\n-{3,}\r?\n/)
            .map((e) => e.trim())
            .filter(Boolean);

          // Parse each entry into fields
          function parseEntry(entry) {
            const fields = {};
            let current = null;
            entry.split(/\r?\n/).forEach((line) => {
              const sec = line.match(/^\[(\w+)\]$/);
              if (sec) {
                current = sec[1].toLowerCase();
                fields[current] = "";
              } else if (current) {
                if (fields[current]) fields[current] += "\n";
                fields[current] += line.trim();
              }
            });
            return fields;
          }

          // Render each publication
          const rendered = entries
            .map((entry) => {
              const f = parseEntry(entry);
              // Image
              let imgHtml = "";
              if (f.image) {
                imgHtml = `<img src="${escapeHtml(f.image)}" alt="${escapeHtml(
                  f.title || "Publication image"
                )}" class="w-28 h-28 sm:w-32 sm:h-32 md:w-36 md:h-36 lg:w-40 lg:h-40 object-cover rounded-xl flex-shrink-0">`;
              }
              // Title
              let titleHtml = f.title
                ? `<div class="font-bold text-xl sm:text-2xl mb-2">${escapeHtml(
                    f.title
                  )}</div>`
                : "";
              // Abstract
              let abstractHtml = f.abstract
                ? `<div class="mb-2 text-base">${escapeHtml(f.abstract)}</div>`
                : "";
              // Author
              let authorHtml = f.author
                ? `<div class="mb-2 text-sm text-slate-600 dark:text-slate-400">${escapeHtml(
                    f.author
                  )}</div>`
                : "";
              // Code button
              let codeHtml = "";
              if (f.code && f.code.startsWith("http")) {
                codeHtml = `<a href="${escapeHtml(
                  f.code
                )}" target="_blank" rel="noopener" class="inline-block mr-2 mb-1 px-4 py-1 rounded bg-teal-600 text-white font-semibold text-sm hover:bg-teal-700 transition align-middle"><i data-lucide="code" class="inline w-4 h-4 mr-1 -mt-0.5"></i>Code</a>`;
              }
              // Paper button
              let paperHtml = "";
              if (f.paper && f.paper.startsWith("http")) {
                paperHtml = `<a href="${escapeHtml(
                  f.paper
                )}" target="_blank" rel="noopener" class="inline-block mb-1 px-4 py-1 rounded bg-slate-700 text-white font-semibold text-sm hover:bg-slate-800 transition align-middle"><i data-lucide="file-text" class="inline w-4 h-4 mr-1 -mt-0.5"></i>Paper</a>`;
              }

              return `
              <div class="publication-item border-b border-slate-200 dark:border-slate-700 py-8">
                  <div class="flex flex-row items-center gap-6 md:gap-8">
                  ${imgHtml}
                  <div class="flex-1 min-w-0 flex flex-col justify-center">
                    ${titleHtml}
                    ${
                      abstractHtml
                        ? `<div class='mb-1'>${abstractHtml}</div>`
                        : ""
                    }
                    ${authorHtml ? `<div class='mb-2'>${authorHtml}</div>` : ""}
                    <div class="mt-2 flex flex-row flex-wrap gap-2">${codeHtml}${paperHtml}</div>
                  </div>
                </div>
              </div>
            `;
            })
            .join("\n");

          document.getElementById("publications-md").innerHTML =
            rendered || `<p class="text-slate-500">No publications found.</p>`;
        })
        .catch((err) => {
          console.error(`Failed to load content/publications.md:`, err);
          document.getElementById(
            "publications-md"
          ).innerHTML = `<p class="text-slate-500">Could not load publications.</p>`;
        });

      // small helper to escape HTML in alt text
      function escapeHtml(str) {
        return String(str).replace(/[&<>"']/g, function (s) {
          return {
            "&": "&amp;",
            "<": "&lt;",
            ">": "&gt;",
            '"': "&quot;",
            "'": "&#39;",
          }[s];
        });
      }

      // Re-render Lucide icons after content is loaded
      setTimeout(() => {
        lucide.createIcons();
      }, 0);
    </script>
  </body>
</html>
